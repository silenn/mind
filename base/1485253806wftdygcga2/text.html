<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'Courier New'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">[<span style=" font-weight:600;">3 Способы уменьшения размера кода</span>]</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В этой секции будут перечислены некоторые советы для уменьшения размера кода. Для каждого будет дано описание и пример кода.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">3.1 Подсказка #1 – типы и размеры данных</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Используйте всегда самые маленькие по размеру данные, насколько это возможно. Оцените свой код на используемые в нем типы данных. Чтение 8-битного значения из регистра требует только однобайтовой переменной, и ни в коем случае не двухбайтовой, это позволит экономить место под код. Размеры типов данных для 8-бит AVR можно найти в хедере &lt; stdint.h &gt;, и они перечислены в таблице 3-1.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Таблица 3-1. Типы данных 8-бит AVR.</p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td colspan="2" bgcolor="#0000ff">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600; color:#ffffff;">Тип данных</span></p></td>
<td bgcolor="#0000ff">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600; color:#ffffff;">Размер</span></p></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">signed char / unsigned char</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">int8_t / uint8_t</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">8 бит</span></p></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">signed int / unsigned int</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">int16_t / uint16_t</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">16 бит</span></p></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">signed long / unsigned long</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">int32_t / uint32_t</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">32 бита</span></p></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">signed long long / unsigned long long</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">int64_t / uint64_t</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">64 бита</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Избегайте некоторых опций компилятора, которые могут изменить эту таблицу (например, avr-gcc -mint8 приводит тип int к 8-битному целому).</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В таблице 3-2 показаны примеры использования типов данных разного размера. Использовалась оптимизация по размеру -Os. Вывод от утилиты avr-size дает возможность оценить размер кода.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Таблица 3-2. Пример использования типов данных разного размера.</p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td bgcolor="#fafad2"></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">unsigned int (16 бит)</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">unsigned char (8 бит)</span></p></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Код на C</span></p></td>
<td bgcolor="#f8f8f8">
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#bc7a00;">#include &lt; avr/io.h &gt; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">unsigned</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#b00040;">int</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">readADC</span><span style=" font-family:'Courier New,courier';">()</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">{ </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">return</span><span style=" font-family:'Courier New,courier';"> ADCH; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">}; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">int</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">main</span><span style=" font-family:'Courier New,courier';">(</span><span style=" font-family:'Courier New,courier'; color:#b00040;">void</span><span style=" font-family:'Courier New,courier';">) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">{ </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; color:#b00040;">unsigned</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#b00040;">int</span><span style=" font-family:'Courier New,courier';"> mAdc </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> readADC();</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">}</span></pre></td>
<td bgcolor="#f8f8f8">
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#bc7a00;">#include &lt; avr/io.h &gt; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">unsigned</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#b00040;">char</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">readADC</span><span style=" font-family:'Courier New,courier';">()</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">{ </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">return</span><span style=" font-family:'Courier New,courier';"> ADCH; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">}; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">int</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">main</span><span style=" font-family:'Courier New,courier';">(</span><span style=" font-family:'Courier New,courier'; color:#b00040;">void</span><span style=" font-family:'Courier New,courier';">) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">{ </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; color:#b00040;">unsigned</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#b00040;">char</span><span style=" font-family:'Courier New,courier';"> mAdc </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> readADC();</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">}</span></pre></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Использование памяти AVR</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Program: 92 bytes (1.1% full)</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Program: 90 bytes (1.1% full)</p></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Уровень оптимизации компилятора</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">-Os (оптимизация по размеру кода)</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">-Os (оптимизация по размеру кода)</p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В примере слева использовался тип данных int (2 байта) для возвращаемой величины из функции readADC(), и для временной переменной, используемой для хранения возвращенного результата readADC().</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В примере слева использовался тип данных char (1 байт). Чтение из регистра ADCH дает только 8 бит, так что размера char достаточно. Видно, что получена экономия 2 байт, когда для возвращаемой величины readADC() и для временной переменной использовалась однобайтовая переменная.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" color:#808080;">Примечание: в этой программе C используется код запуска (startup code), который выполняется до входа в функцию main(). Именно поэтому такая простая программа на C занимает целых 90 байт.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">3.2 Подсказка #2 – глобальные и локальные переменные</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В большинстве случаев не рекомендуется использовать глобальные переменные. Всегда, где только возможно, используйте локальные переменные. Если переменная используется только в функции, то она должна быть декларирована внутри тела функции как локальная переменная.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В теории программирования выбор между декларированием глобальной или локальной переменной зависит от того, как будет использоваться эта переменная.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если декларируется глобальная переменная, то ей назначается уникальный адрес SRAM во время линковки программы. Также доступ к глобальной переменной обычно будет требовать дополнительных байт кода (обычно 2 байта для большого 16-битного адреса) для получения адреса переменной.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Локальные переменные при декларировании предпочтительно назначаются на регистр или выделенное место в стеке. Как только функция активизируется, локальные переменные также автоматически становятся активными. На выходе из функции локальные переменные могут быть уничтожены.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В таблице 3-3 показано два примера с глобальными и локальными переменными.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Таблица 3-3. Пример использования глобальных и локальных переменных.</p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td bgcolor="#fafad2"></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">глобальные переменные</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">локальные переменные</span></p></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Код на C</span></p></td>
<td bgcolor="#f8f8f8">
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#bc7a00;">#include &lt; avr/io.h &gt; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">uint8_t</span><span style=" font-family:'Courier New,courier';"> global_1; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">int</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">main</span><span style=" font-family:'Courier New,courier';">(</span><span style=" font-family:'Courier New,courier'; color:#b00040;">void</span><span style=" font-family:'Courier New,courier';">) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">{ </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   global_1 </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0xAA</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   PORTB </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> global_1; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">}</span></pre></td>
<td bgcolor="#f8f8f8">
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#bc7a00;">#include &lt; avr/io.h &gt; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">int</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">main</span><span style=" font-family:'Courier New,courier';">(</span><span style=" font-family:'Courier New,courier'; color:#b00040;">void</span><span style=" font-family:'Courier New,courier';">) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">{ </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; color:#b00040;">uint8_t</span><span style=" font-family:'Courier New,courier';"> local_1; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   local_1 </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0xAA</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   PORTB </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> local_1; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">}</span></pre></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Использование памяти AVR</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Program: 104 bytes (1.3% full) <br />(.text + .data + .bootloader) <br />Data: 1 byte (0.1% full) <br />(.data + .bss + .noinit)</p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Program: 84 bytes (1.0% full) <br />(.text + .data + .bootloader) <br />Data: 0 bytes (0.0% full) <br />(.data + .bss + .noinit)</p></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Уровень оптимизации компилятора</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">-Os (оптимизация по размеру кода)</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">-Os (оптимизация по размеру кода)</p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В примере слева была декларирована однобайтовая глобальная переменная. Вывод утилиты avr-size показал 104 байта занятого места под код на включенной оптимизации -Os (оптимизация по размеру кода).</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В примере справа переменная была декларирована в теле функции main() как локальная, размер кода уменьшился до 84 байт, и при этом память SRAM вообще не использовалась.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">3.3 Подсказка #3 – индекс цикла (Loop index)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Циклы широко используются в коде 8-bit AVR. Это циклы &quot;while ( ) { }&quot;, &quot;for ( )&quot; и &quot;do { } while ( )&quot;. Если разрешена опция оптимизации -Os, компилятор будет автоматически оптимизировать циклы для получения того же размера кода.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Однако и тут еще можно незначительно уменьшить объем кода. Если используется цикл &quot;do { } while ( )&quot;, то инкремент или декремент индекса цикла будет давать в результате разный размер кода. Обычно мы пишем циклы так, что индекс считает от 0 до максимального значения (используется инкремент), но более эффективно использовать счетчик цикла от максимума до нуля (декремент).</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Причина в том, что цикл с инкрементом нуждается в инструкции сравнения - чтобы сравнить текущее значение индекса цикла с максимальной величиной на каждой итерации цикла. Так проверяется, достигла ли величина индекса максимального значения. Когда используется цикл с декрементом, то это сравнение уже не нужно, потому что результат декремента индекса цикла установит флаг нуля Z (zero flag) в регистре SREG, если индекс стал равен 0.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В таблице 3-4 даны два примера, показывающих сгенерированный код для цикла &quot;do { } while ( )&quot; в вариантах с инкрементом и декрементом. Здесь также включена оптимизация по размеру кода -Os.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Таблица 3-4. Примеры цикла do { } while ( ) с инкрементом и декрементом переменной индекса цикла.</p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td bgcolor="#fafad2"></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">do {} while с инкрементом индекса</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600; background-color:#fafad2;">do {} while с декрементом индекса</span></p></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Код на C</span></p></td>
<td bgcolor="#f8f8f8">
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#bc7a00;">#include &lt; avr/io.h &gt; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">int</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">main</span><span style=" font-family:'Courier New,courier';">(</span><span style=" font-family:'Courier New,courier'; color:#b00040;">void</span><span style=" font-family:'Courier New,courier';">) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">{ </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; color:#b00040;">uint8_t</span><span style=" font-family:'Courier New,courier';"> local_1 </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">do</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   { </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      PORTB </span><span style=" font-family:'Courier New,courier'; color:#666666;">^=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x01</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      local_1</span><span style=" font-family:'Courier New,courier'; color:#666666;">++</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   } </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">while</span><span style=" font-family:'Courier New,courier';"> (local_1 </span><span style=" font-family:'Courier New,courier'; color:#666666;">&lt;</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">100</span><span style=" font-family:'Courier New,courier';">); </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">}</span></pre></td>
<td bgcolor="#f8f8f8">
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#bc7a00;">#include &lt; avr/io.h &gt; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">int</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">main</span><span style=" font-family:'Courier New,courier';">(</span><span style=" font-family:'Courier New,courier'; color:#b00040;">void</span><span style=" font-family:'Courier New,courier';">) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">{ </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; color:#b00040;">uint8_t</span><span style=" font-family:'Courier New,courier';"> local_1 </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">100</span><span style=" font-family:'Courier New,courier';">;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">do</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   { </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      PORTB </span><span style=" font-family:'Courier New,courier'; color:#666666;">^=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x01</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      local_1</span><span style=" font-family:'Courier New,courier'; color:#666666;">--</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   } </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">while</span><span style=" font-family:'Courier New,courier';"> (local_1); </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">}</span></pre></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Использование памяти AVR</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Program: 96 bytes (1.2% full) <br />(.text + .data + .bootloader) <br />Data: 0 bytes (0.0% full) <br />(.data + .bss + .noinit)</p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Program: 94 bytes (1.1% full) <br />(.text + .data + .bootloader) <br />Data: 0 bytes (0.0% full) <br />(.data + .bss + .noinit)</p></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Уровень оптимизации компилятора</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">-Os (оптимизация по размеру кода)</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">-Os (оптимизация по размеру кода)</p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Чтобы ясно сравнить строки кода C, этот пример написан в стиле &quot;do {count-- ;} while (count);&quot;, а не как обычно использующийся в книгах код &quot;do {} while (--count);&quot;. Эти два стиля генерируют алгоритмически одинаковый код.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">3.4 Подсказка #4 – совмещение циклов (Loop jamming)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Под Loop jamming подразумевается интегрирование операторов и операций из различных циклов с целью уменьшения количества циклов или для создания одного цикла - чтобы уменьшить количество циклов в коде.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В некоторых случаях циклы реализуются один за другим. В результате может получиться большое количество итераций. В этом случае loop jamming может помочь в увеличении эффективности кода, если несколько циклов скомбинировать в один.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Loop jamming уменьшает размер кода и работает быстрее, потому что устраняется лишняя нагрузка по повторению циклов. В таблице 3-5 можно увидеть, как работает loop jamming.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Таблица 3-5. Пример использования loop jamming.</p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td bgcolor="#fafad2"></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">раздельные циклы</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">совмещенные циклы</span></p></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Код на C</span></p></td>
<td bgcolor="#f8f8f8">
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#bc7a00;">#include &lt; avr/io.h &gt; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">int</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">main</span><span style=" font-family:'Courier New,courier';">(</span><span style=" font-family:'Courier New,courier'; color:#b00040;">void</span><span style=" font-family:'Courier New,courier';">) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">{ </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; color:#b00040;">uint8_t</span><span style=" font-family:'Courier New,courier';"> i, total </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; color:#b00040;">uint8_t</span><span style=" font-family:'Courier New,courier';"> tmp[</span><span style=" font-family:'Courier New,courier'; color:#666666;">10</span><span style=" font-family:'Courier New,courier';">] </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> {</span><span style=" font-family:'Courier New,courier'; color:#666666;">0</span><span style=" font-family:'Courier New,courier';">}; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">for</span><span style=" font-family:'Courier New,courier';"> (i</span><span style=" font-family:'Courier New,courier'; color:#666666;">=0</span><span style=" font-family:'Courier New,courier';">; i</span><span style=" font-family:'Courier New,courier'; color:#666666;">&lt;10</span><span style=" font-family:'Courier New,courier';">; i</span><span style=" font-family:'Courier New,courier'; color:#666666;">++</span><span style=" font-family:'Courier New,courier';">)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   { </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      tmp [i] </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> ADCH; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   } </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">for</span><span style=" font-family:'Courier New,courier';"> (i</span><span style=" font-family:'Courier New,courier'; color:#666666;">=0</span><span style=" font-family:'Courier New,courier';">; i</span><span style=" font-family:'Courier New,courier'; color:#666666;">&lt;10</span><span style=" font-family:'Courier New,courier';">; i</span><span style=" font-family:'Courier New,courier'; color:#666666;">++</span><span style=" font-family:'Courier New,courier';">)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   { </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      total </span><span style=" font-family:'Courier New,courier'; color:#666666;">+=</span><span style=" font-family:'Courier New,courier';"> tmp[i]; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   }</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   UDR0 </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> total; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">}</span></pre></td>
<td bgcolor="#f8f8f8">
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#bc7a00;">#include &lt; avr/io.h &gt; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">int</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">main</span><span style=" font-family:'Courier New,courier';">(</span><span style=" font-family:'Courier New,courier'; color:#b00040;">void</span><span style=" font-family:'Courier New,courier';">) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">{ </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; color:#b00040;">uint8_t</span><span style=" font-family:'Courier New,courier';"> i, total </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; color:#b00040;">uint8_t</span><span style=" font-family:'Courier New,courier';"> tmp[</span><span style=" font-family:'Courier New,courier'; color:#666666;">10</span><span style=" font-family:'Courier New,courier';">] </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> {</span><span style=" font-family:'Courier New,courier'; color:#666666;">0</span><span style=" font-family:'Courier New,courier';">}; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">for</span><span style=" font-family:'Courier New,courier';"> (i</span><span style=" font-family:'Courier New,courier'; color:#666666;">=0</span><span style=" font-family:'Courier New,courier';">; i</span><span style=" font-family:'Courier New,courier'; color:#666666;">&lt;10</span><span style=" font-family:'Courier New,courier';">; i</span><span style=" font-family:'Courier New,courier'; color:#666666;">++</span><span style=" font-family:'Courier New,courier';">)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   { </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      tmp [i] </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> ADCH; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      total </span><span style=" font-family:'Courier New,courier'; color:#666666;">+=</span><span style=" font-family:'Courier New,courier';"> tmp[i]; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   }</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   UDR0 </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> total; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">}</span></pre></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Использование памяти AVR</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Program: 164 bytes (2.0% full) <br />(.text + .data + .bootloader) <br />Data: 0 bytes (0.0% full) <br />(.data + .bss + .noinit)</p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Program: 98 bytes (1.2% full) <br />(.text + .data + .bootloader) <br />Data: 0 bytes (0.0% full) <br />(.data + .bss + .noinit)</p></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Уровень оптимизации компилятора</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">-Os (оптимизация по размеру кода)</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">-Os (оптимизация по размеру кода)</p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">3.5 Подсказка #5 – константы в памяти программ</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Часто в программе память SRAM заканчивается быстрее, чем память FLASH. Глобальные переменные констант, таблицы или массивы, содержимое которых остается всегда неизменным, должны быть обычно размещены в секции только для чтения (read-only section, Flash или EEPROM на 8-bit AVR). Это поможет сохранить свободное место в дефицитной памяти SRAM.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В этом примере не будет использоваться ключевое слово &quot;const&quot; языка C. Декларирование объекта со словом &quot;const&quot; всего лишь показывает, что его величина не будет изменена. Атрибут &quot;const&quot; используется, чтобы сообщить компилятору, что данные в переменной только для чтения (read-only), и это увеличивает возможности для оптимизации. Атрибут &quot;const&quot; не говорит о том, где должны быть размещены данные.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для размещения данных в области памяти программ (read-only) и получения их оттуда библиотека AVR-Libc предоставляет простой макрос &quot;PROGMEM&quot; и макрос &quot;pgm_read_byte&quot;. Эти макросы определены в системном хедере &lt; avr/pgmspace.h &gt;.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В таблице 3-6 показано, как можно сохранить память SRAM путем переноса глобальной переменной строки в область памяти программ.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Таблица 3-6. Пример констант в памяти программ (FLASH).</p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td bgcolor="#fafad2"></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">константы в области данных (SRAM)</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">константы в области памяти программ (FLASH)</span></p></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Код на C</span></p></td>
<td bgcolor="#f8f8f8">
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#bc7a00;">#include &lt; avr/io.h &gt; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">uint8_t</span><span style=" font-family:'Courier New,courier';"> string[</span><span style=" font-family:'Courier New,courier'; color:#666666;">12</span><span style=" font-family:'Courier New,courier';">] </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> {</span><span style=" font-family:'Courier New,courier'; color:#ba2121;">&quot;hello world!&quot;</span><span style=" font-family:'Courier New,courier';">}; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">int</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">main</span><span style=" font-family:'Courier New,courier';">(</span><span style=" font-family:'Courier New,courier'; color:#b00040;">void</span><span style=" font-family:'Courier New,courier';">) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">{ </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   UDR0 </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> string[</span><span style=" font-family:'Courier New,courier'; color:#666666;">10</span><span style=" font-family:'Courier New,courier';">]; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">}</span></pre></td>
<td bgcolor="#f8f8f8">
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#bc7a00;">#include &lt; avr/io.h &gt; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#bc7a00;">#include &lt; avr/pgmspace.h &gt;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">uint8_t</span><span style=" font-family:'Courier New,courier';"> string[</span><span style=" font-family:'Courier New,courier'; color:#666666;">12</span><span style=" font-family:'Courier New,courier';">] PROGMEM </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> {</span><span style=" font-family:'Courier New,courier'; color:#ba2121;">&quot;hello world!&quot;</span><span style=" font-family:'Courier New,courier';">};</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">int</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">main</span><span style=" font-family:'Courier New,courier';">(</span><span style=" font-family:'Courier New,courier'; color:#b00040;">void</span><span style=" font-family:'Courier New,courier';">) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">{ </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   UDR0 </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> pgm_read_byte(</span><span style=" font-family:'Courier New,courier'; color:#666666;">&amp;</span><span style=" font-family:'Courier New,courier';">string[</span><span style=" font-family:'Courier New,courier'; color:#666666;">10</span><span style=" font-family:'Courier New,courier';">]); </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">}</span></pre></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Использование памяти AVR</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Program: 122 bytes (1.5% full) <br />(.text + .data + .bootloader) <br />Data: 12 bytes (1.2% full) <br />(.data + .bss + .noinit)</p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Program: 102 bytes (1.2% full) <br />(.text + .data + .bootloader) <br />Data: 0 bytes (0.0% full) <br />(.data + .bss + .noinit)</p></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Уровень оптимизации компилятора</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">-Os (оптимизация по размеру кода)</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">-Os (оптимизация по размеру кода)</p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">После того, как мы разместили константы в памяти программ, занятые области программы и данных обе уменьшились. Однако при чтении данных из памяти программ будет незначительная лишняя нагрузка, потому что выполнение функции будет медленнее, чем прямое чтение из SRAM.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если данные, сохраненные в FLASH, используются в коде несколько раз, то мы получим размер кода меньше, если будет использоваться временная переменная вместо прямого использования макроса &quot;pgm_read_byte&quot; несколько раз.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В файле системного хедера &lt; avr/pgmspace.h &gt; имеется еще функции и макросы для сохранения/получения различных типов данных в/из области памяти программ. Для дополнительной информации обратитесь к руководству avr-libc. Также см. [5].</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">3.6 Подсказка #6 – типы доступа: static</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для глобальных данных используйте везде, где это возможно, ключевое слово static. Если глобальные переменные декларированы с ключевым словом static, то они могут быть доступны только в том файле (модуле C), где были определены. Это предотвращает от незапланированного использования переменной (как внешней переменной, external) в коде других модулей. Это уменьшает количество потенциальных ошибок, что безусловно полезно (хотя и никак не влияет на размер и быстродействие кода).</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">С другой стороны, необходимо избегать использования static для локальных переменных, декларированных в теле функции. Значение локальных &quot;static&quot; переменных должно быть сохранено между отдельными вызовами функции, и значение переменной сохраняется в течение всего времени работы программы. Это требует постоянной выделенной области данных (SRAM), а также дополнительного кода для доступа к таким переменным. Переменная static в теле функции ведет себя для аспектов оптимизации так же, как и глобальная переменная, и отличается от глобальной переменной только областью видимости (переменная static видна только в теле функции, где была определена).</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Функция static проще в оптимизации, поскольку её имя невидимо извне файла (модуля C), где функция была определена, и она не может быть вызвана из других модулей. Если функция static вызывается только 1 раз в файле, компиляция которого произведена с оптимизацией (-O1, -O2, -O3 и -Os), то функция будет автоматически оптимизирована компилятором и заменена встраиванием кода (inline function) при этом не будут использоваться ассемблерные инструкции вызова подпрограммы (call) и возврата (ret). Посмотрите примеры в таблице 3-7.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Таблица 3-7. Пример типов доступа: статическая функция.</p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td bgcolor="#fafad2"></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">глобальная функция (вызывается один раз)</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">функция static (вызывается один раз)</span></p></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Код на C</span></p></td>
<td bgcolor="#f8f8f8">
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#bc7a00;">#include &lt; avr/io.h &gt; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">uint8_t</span><span style=" font-family:'Courier New,courier';"> string[</span><span style=" font-family:'Courier New,courier'; color:#666666;">12</span><span style=" font-family:'Courier New,courier';">] </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> {</span><span style=" font-family:'Courier New,courier'; color:#ba2121;">&quot;hello world!&quot;</span><span style=" font-family:'Courier New,courier';">}; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">void</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">USART_TX</span><span style=" font-family:'Courier New,courier';">(</span><span style=" font-family:'Courier New,courier'; color:#b00040;">uint8_t</span><span style=" font-family:'Courier New,courier';"> data); </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">int</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">main</span><span style=" font-family:'Courier New,courier';">(</span><span style=" font-family:'Courier New,courier'; color:#b00040;">void</span><span style=" font-family:'Courier New,courier';">) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">{ </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; color:#b00040;">uint8_t</span><span style=" font-family:'Courier New,courier';"> i </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">while</span><span style=" font-family:'Courier New,courier';"> (i</span><span style=" font-family:'Courier New,courier'; color:#666666;">&lt;12</span><span style=" font-family:'Courier New,courier';">)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   { </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      USART_TX(string[i</span><span style=" font-family:'Courier New,courier'; color:#666666;">++</span><span style=" font-family:'Courier New,courier';">]); </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   } </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">} </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">void</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">USART_TX</span><span style=" font-family:'Courier New,courier';">(</span><span style=" font-family:'Courier New,courier'; color:#b00040;">uint8_t</span><span style=" font-family:'Courier New,courier';"> data) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">{ </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">while</span><span style=" font-family:'Courier New,courier';">(</span><span style=" font-family:'Courier New,courier'; color:#666666;">!</span><span style=" font-family:'Courier New,courier';">(UCSR0A</span><span style=" font-family:'Courier New,courier'; color:#666666;">&amp;</span><span style=" font-family:'Courier New,courier';">(</span><span style=" font-family:'Courier New,courier'; color:#666666;">1</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">&lt;&lt;</span><span style=" font-family:'Courier New,courier';"> UDRE0))); </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   UDR0 </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> data; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">}</span></pre></td>
<td bgcolor="#f8f8f8">
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#bc7a00;">#include &lt; avr/io.h &gt; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">uint8_t</span><span style=" font-family:'Courier New,courier';"> string[</span><span style=" font-family:'Courier New,courier'; color:#666666;">12</span><span style=" font-family:'Courier New,courier';">] </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> {</span><span style=" font-family:'Courier New,courier'; color:#ba2121;">&quot;hello world!&quot;</span><span style=" font-family:'Courier New,courier';">}; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">static</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#b00040;">void</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">USART_TX</span><span style=" font-family:'Courier New,courier';">(</span><span style=" font-family:'Courier New,courier'; color:#b00040;">uint8_t</span><span style=" font-family:'Courier New,courier';"> data); </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">int</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">main</span><span style=" font-family:'Courier New,courier';">(</span><span style=" font-family:'Courier New,courier'; color:#b00040;">void</span><span style=" font-family:'Courier New,courier';">) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">{ </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; color:#b00040;">uint8_t</span><span style=" font-family:'Courier New,courier';"> i </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">while</span><span style=" font-family:'Courier New,courier';"> (i</span><span style=" font-family:'Courier New,courier'; color:#666666;">&lt;12</span><span style=" font-family:'Courier New,courier';">)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   { </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      USART_TX(string[i</span><span style=" font-family:'Courier New,courier'; color:#666666;">++</span><span style=" font-family:'Courier New,courier';">]); </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   } </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">} </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">void</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">USART_TX</span><span style=" font-family:'Courier New,courier';">(</span><span style=" font-family:'Courier New,courier'; color:#b00040;">uint8_t</span><span style=" font-family:'Courier New,courier';"> data) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">{ </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">while</span><span style=" font-family:'Courier New,courier';">(</span><span style=" font-family:'Courier New,courier'; color:#666666;">!</span><span style=" font-family:'Courier New,courier';">(UCSR0A</span><span style=" font-family:'Courier New,courier'; color:#666666;">&amp;</span><span style=" font-family:'Courier New,courier';">(</span><span style=" font-family:'Courier New,courier'; color:#666666;">1</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">&lt;&lt;</span><span style=" font-family:'Courier New,courier';"> UDRE0))); </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   UDR0 </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> data; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">}</span></pre></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Использование памяти AVR</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Program: 152 bytes (1.9% full) <br />(.text + .data + .bootloader) <br />Data: 12 bytes (1.2% full) <br />(.data + .bss + .noinit)</p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Program: 140 bytes (1.7% full) <br />(.text + .data + .bootloader) <br />Data: 12 bytes (1.2% full) <br />(.data + .bss + .noinit)</p></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Уровень оптимизации компилятора</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">-Os (оптимизация по размеру кода)</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">-Os (оптимизация по размеру кода)</p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" color:#808080;">Примечание: если функция вызывается несколько раз, то она не будет преобразована во встраиваемую (inline function), потому что это приведет к увеличению размера кода по сравнению с прямым вызовом функции (ассемблерные инструкции call/ret).</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">3.7 Подсказка #7 – низкоуровневые инструкции ассемблера</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Хорошо написанный код на ассемблере всегда лучше оптимизированного кода C. Недостаток кодирования на ассемблере - непортируемый (и довольно запутанный для AVR GCC) синтаксис, так что его использование в большинстве случаев не рекомендуется.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Однако использование макросов на ассемблере уменьшает головную боль, часто связанную с кодом ассемблера, а также улучшает читаемость и портируемость кода. Используйте макросы вместо функций для задач, которые генерируют меньше 2..3 строк кода ассемблера. Пример в таблице 3-8 показывает использование кода в ассемблерном макросе в сравнении с использованием функции.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Таблица 3-8. Пример использования низкоуровневых инструкций ассемблера.</p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td bgcolor="#fafad2"></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">функция</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">макрос на ассемблере</span></p></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Код на C</span></p></td>
<td bgcolor="#f8f8f8">
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#bc7a00;">#include &lt; avr/io.h &gt; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">void</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">enable_usart_rx</span><span style=" font-family:'Courier New,courier';">(</span><span style=" font-family:'Courier New,courier'; color:#b00040;">void</span><span style=" font-family:'Courier New,courier';">) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">{ </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   UCSR0B </span><span style=" font-family:'Courier New,courier'; color:#666666;">|=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x80</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">}; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">int</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">main</span><span style=" font-family:'Courier New,courier';">(</span><span style=" font-family:'Courier New,courier'; color:#b00040;">void</span><span style=" font-family:'Courier New,courier';">) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">{ </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   enable_usart_rx(); </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">while</span><span style=" font-family:'Courier New,courier';"> (</span><span style=" font-family:'Courier New,courier'; color:#666666;">1</span><span style=" font-family:'Courier New,courier';">) {} </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">}</span></pre></td>
<td bgcolor="#f8f8f8">
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#bc7a00;">#include &lt; avr/io.h &gt; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#bc7a00;">#define enable_usart_rx() \ </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">__asm__ </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">__volatile__</span><span style=" font-family:'Courier New,courier';"> ( \ </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">    </span><span style=" font-family:'Courier New,courier'; color:#ba2121;">&quot;lds r24,0x00C1&quot;</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#ba2121;">&quot;</span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#bb6622;">\n\t</span><span style=" font-family:'Courier New,courier'; color:#ba2121;">&quot;</span><span style=" font-family:'Courier New,courier';"> \ </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">    </span><span style=" font-family:'Courier New,courier'; color:#ba2121;">&quot;ori r24, 0x80&quot;</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#ba2121;">&quot;</span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#bb6622;">\n\t</span><span style=" font-family:'Courier New,courier'; color:#ba2121;">&quot;</span><span style=" font-family:'Courier New,courier';"> \ </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">    </span><span style=" font-family:'Courier New,courier'; color:#ba2121;">&quot;sts 0x00C1, r24&quot;</span><span style=" font-family:'Courier New,courier';"> \ </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">    </span><span style=" font-family:'Courier New,courier'; color:#666666;">::</span><span style=" font-family:'Courier New,courier';">) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">int</span><span style=" font-family:'Courier New,courier';"> main(</span><span style=" font-family:'Courier New,courier'; color:#b00040;">void</span><span style=" font-family:'Courier New,courier';">) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">{ </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   enable_usart_rx(); </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">while</span><span style=" font-family:'Courier New,courier';"> (</span><span style=" font-family:'Courier New,courier'; color:#666666;">1</span><span style=" font-family:'Courier New,courier';">){} </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">}</span></pre></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Использование памяти AVR</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Program: 90 bytes (1.1% full) <br />(.text + .data + .bootloader) <br />Data: 0 bytes (0.0% full) <br />(.data + .bss + .noinit)</p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Program: 86 bytes (1.0% full) <br />(.text + .data + .bootloader) <br />Data: 0 bytes (0.0% full) <br />(.data + .bss + .noinit)</p></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Уровень оптимизации компилятора</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">-Os (оптимизация по размеру кода)</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">-Os (оптимизация по размеру кода)</p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для подробностей по использованию кода ассемблера совместно с кодом на C платформы 8-bit AVR обратитесь к секции &quot;Inline Assembler Cookbook&quot; руководства пользователя avr-libc. См. также [6].</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">[<span style=" font-weight:600;">4 Способы уменьшения времени выполнения</span>]</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В этой секции будут рассмотрены некоторые советы по уменьшению времени выполнения кода (это повышает скорость работы программы). Для каждого совета будут даны описание и пример кода.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">4.1 Подсказка #8 – типы и размеры данных</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В дополнение к уменьшению размера кода, правильный выбор типа и размера данных также уменьшает и время выполнения. Для 8-bit AVR доступ к 8-bit (Byte) переменной всегда будет самым эффективным. В таблице 4-1 показано различие использования 8-bit и 16-bit переменных.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Таблица 4-1. Примеры использования типов данных разного размера.</p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td bgcolor="#fafad2"></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">16-битная переменная</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">8-битная переменная</span></p></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Код на C</span></p></td>
<td bgcolor="#f8f8f8">
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#bc7a00;">#include &lt; avr/io.h &gt; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">int</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">main</span><span style=" font-family:'Courier New,courier';">(</span><span style=" font-family:'Courier New,courier'; color:#b00040;">void</span><span style=" font-family:'Courier New,courier';">) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">{ </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; color:#b00040;">uint16_t</span><span style=" font-family:'Courier New,courier';"> local_1 </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">10</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">do</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   {</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      PORTB </span><span style=" font-family:'Courier New,courier'; color:#666666;">^=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x80</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   } </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">while</span><span style=" font-family:'Courier New,courier';"> (</span><span style=" font-family:'Courier New,courier'; color:#666666;">--</span><span style=" font-family:'Courier New,courier';">local_1);</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">}</span></pre></td>
<td bgcolor="#f8f8f8">
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#bc7a00;">#include &lt; avr/io.h &gt; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">int</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">main</span><span style=" font-family:'Courier New,courier';">(</span><span style=" font-family:'Courier New,courier'; color:#b00040;">void</span><span style=" font-family:'Courier New,courier';">) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">{ </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; color:#b00040;">uint8_t</span><span style=" font-family:'Courier New,courier';"> local_1 </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">10</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">do</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   {</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      PORTB </span><span style=" font-family:'Courier New,courier'; color:#666666;">^=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x80</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   } </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">while</span><span style=" font-family:'Courier New,courier';"> (</span><span style=" font-family:'Courier New,courier'; color:#666666;">--</span><span style=" font-family:'Courier New,courier';">local_1);</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">}</span></pre></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Использование памяти AVR</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Program: 94 bytes (1.1% full) <br />(.text + .data + .bootloader) <br />Data: 0 bytes (0.0% full) <br />(.data + .bss + .noinit)</p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Program: 92 bytes (1.1% full) <br />(.text + .data + .bootloader) <br />Data: 0 bytes (0.0% full) <br />(.data + .bss + .noinit)</p></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Счетчик тактов</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">90</p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">79</p></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Уровень оптимизации компилятора</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">-O2</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">-O2</p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" color:#808080;">Примечание: при использовании опции –O3 циклы будут автоматически развернуты. Тогда итерации цикла будут преобразованы в повторяющиеся операции с количеством индекса цикла, так что для этого примера не будет различия в генерируемом коде при использовании опции –O3.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">4.2 Подсказка #9 - оператор условия</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Обычно преддекремент и постдекремент (или прединкремент и постинкремент) в нормальном коде не имеют различий. Например, &quot;i--;&quot; и &quot;--i;&quot; просто сгенерируют один и тот же ассемблерный код. Однако использование этих операторов в условии цикла приводят в различиям в генерируемом коде.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Как показано в &quot;подсказке #3 – индекс цикла&quot;, использование индекса цикла с декрементом эффективнее в аспекте размера кода. Но это также позволяет получить более быстрый код для операторов условия.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Кроме того, преддекремент и постдекремент также дают разные результаты. В таблице 4-2 можно увидеть, что для оператора условия с преддекрементом код получается быстрее. Значение счетчика тактов (cycle counter) показывает время выполнения самой длинной итерации цикла.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Таблица 4-2. Пример различных операторов условия цикла.</p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td bgcolor="#fafad2"></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">постдекремент в операторе условия</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600; background-color:#fafad2;">преддекремент в операторе условия</span></p></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Код на C</span></p></td>
<td bgcolor="#f8f8f8">
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#bc7a00;">#include &lt; avr/io.h &gt; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">int</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">main</span><span style=" font-family:'Courier New,courier';">(</span><span style=" font-family:'Courier New,courier'; color:#b00040;">void</span><span style=" font-family:'Courier New,courier';">) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">{ </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; color:#b00040;">uint8_t</span><span style=" font-family:'Courier New,courier';"> loop_cnt </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">9</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">do</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   {</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">if</span><span style=" font-family:'Courier New,courier';"> (loop_cnt</span><span style=" font-family:'Courier New,courier'; color:#666666;">--</span><span style=" font-family:'Courier New,courier';">)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      { </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">         PORTC </span><span style=" font-family:'Courier New,courier'; color:#666666;">^=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x01</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      }</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">else</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      { </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">         PORTB </span><span style=" font-family:'Courier New,courier'; color:#666666;">^=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x01</span><span style=" font-family:'Courier New,courier';">;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">         loop_cnt </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">9</span><span style=" font-family:'Courier New,courier';">;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      } </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   } </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">while</span><span style=" font-family:'Courier New,courier';"> (</span><span style=" font-family:'Courier New,courier'; color:#666666;">1</span><span style=" font-family:'Courier New,courier';">);</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">}</span></pre></td>
<td bgcolor="#f8f8f8">
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#bc7a00;">#include &lt; avr/io.h &gt; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">int</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">main</span><span style=" font-family:'Courier New,courier';">(</span><span style=" font-family:'Courier New,courier'; color:#b00040;">void</span><span style=" font-family:'Courier New,courier';">) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">{ </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; color:#b00040;">uint8_t</span><span style=" font-family:'Courier New,courier';"> loop_cnt </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">10</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">do</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   {</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">if</span><span style=" font-family:'Courier New,courier';"> (</span><span style=" font-family:'Courier New,courier'; color:#666666;">--</span><span style=" font-family:'Courier New,courier';">loop_cnt)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      {</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">         PORTC </span><span style=" font-family:'Courier New,courier'; color:#666666;">^=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x01</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      }</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">else</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      {</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">         PORTB </span><span style=" font-family:'Courier New,courier'; color:#666666;">^=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x01</span><span style=" font-family:'Courier New,courier';">;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">         loop_cnt </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">10</span><span style=" font-family:'Courier New,courier';">;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      }</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   } </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">while</span><span style=" font-family:'Courier New,courier';"> (</span><span style=" font-family:'Courier New,courier'; color:#666666;">1</span><span style=" font-family:'Courier New,courier';">);</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">}</span></pre></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Использование памяти AVR</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Program: 104 bytes (1.3% full) <br />(.text + .data + .bootloader) <br />Data: 0 bytes (0.0% full) <br />(.data + .bss + .noinit)</p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Program: 102 bytes (1.2% full) <br />(.text + .data + .bootloader) <br />Data: 0 bytes (0.0% full) <br />(.data + .bss + .noinit)</p></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Счетчик тактов</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">75</p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">61</p></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Уровень оптимизации компилятора</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">-O3</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">-O3</p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Переменной &quot;loop_cnt&quot; в двух примерах таблицы 4-2 присвоены разные значения, чтобы код работал одинаково: PORTC0 будет переключен 9 раз, POTRB0 переключится один раз на каждое повторение цикла.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">4.3 Подсказка #10 – развернутые циклы</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В некоторых случаях нужно развернуть циклы в последовательность одинаковых операций, чтобы увеличить скорость выполнения кода. Это особенно эффективно для коротких циклов. После того, как цикл развернут, нет никакой операции проверки цикла, и выполняется гораздо меньше операций на каждую итерацию цикла. Пример в таблице 4-3 переключает ножку порта 10 раз.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Таблица 4-3. Пример развертки цикла.</p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td bgcolor="#fafad2"></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">обычный цикл</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">развернутый цикл</span></p></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Код на C</span></p></td>
<td bgcolor="#f8f8f8">
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#bc7a00;">#include &lt; avr/io.h &gt; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">int</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">main</span><span style=" font-family:'Courier New,courier';">(</span><span style=" font-family:'Courier New,courier'; color:#b00040;">void</span><span style=" font-family:'Courier New,courier';">) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">{ </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; color:#b00040;">uint8_t</span><span style=" font-family:'Courier New,courier';"> loop_cnt </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">10</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">do</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   {</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      PORTB </span><span style=" font-family:'Courier New,courier'; color:#666666;">^=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x01</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   } </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">while</span><span style=" font-family:'Courier New,courier';"> (</span><span style=" font-family:'Courier New,courier'; color:#666666;">--</span><span style=" font-family:'Courier New,courier';">loop_cnt);</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">}</span></pre></td>
<td bgcolor="#f8f8f8">
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#bc7a00;">#include &lt; avr/io.h &gt; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">int</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">main</span><span style=" font-family:'Courier New,courier';">(</span><span style=" font-family:'Courier New,courier'; color:#b00040;">void</span><span style=" font-family:'Courier New,courier';">) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">{ </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   PORTB </span><span style=" font-family:'Courier New,courier'; color:#666666;">^=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x01</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   PORTB </span><span style=" font-family:'Courier New,courier'; color:#666666;">^=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x01</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   PORTB </span><span style=" font-family:'Courier New,courier'; color:#666666;">^=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x01</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   PORTB </span><span style=" font-family:'Courier New,courier'; color:#666666;">^=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x01</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   PORTB </span><span style=" font-family:'Courier New,courier'; color:#666666;">^=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x01</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   PORTB </span><span style=" font-family:'Courier New,courier'; color:#666666;">^=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x01</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   PORTB </span><span style=" font-family:'Courier New,courier'; color:#666666;">^=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x01</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   PORTB </span><span style=" font-family:'Courier New,courier'; color:#666666;">^=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x01</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   PORTB </span><span style=" font-family:'Courier New,courier'; color:#666666;">^=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x01</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   PORTB </span><span style=" font-family:'Courier New,courier'; color:#666666;">^=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x01</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">}</span></pre></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Использование памяти AVR</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Program: 94 bytes (1.5% full) <br />(.text + .data + .bootloader) <br />Data: 0 bytes (0.1% full) <br />(.data + .bss + .noinit)</p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Program: 142 bytes (1.7% full) <br />(.text + .data + .bootloader) <br />Data: 0 bytes (0.0% full) <br />(.data + .bss + .noinit)</p></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Счетчик тактов</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">80</p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">50</p></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Уровень оптимизации компилятора</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">-O2</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">-O2</p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Путем развертки цикла do { } while ( ) мы значительно увеличили скорость выполнения кода с 80 циклов до 50.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Имейте в виду, что после развертки цикла размер кода увеличился с 94 до 142 байт. Это хороший пример компромисса в оптимизации между скоростью кода и его размером.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" color:#808080;">Примечание: если для этого примера разрешена опция -O3, то компилятор сам автоматически развернет цикл, и будет сгенерирован тот же самый код, что и написанный вручную как в примере справа.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">4.4 Подсказка #11 – управление потоком выполнения (Control flow): If-else и switch-case</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Конструкции &quot;if-else&quot; и &quot;switch-case&quot; широко используются в программировании на C; правильная организация ветвей может уменьшить время выполнения кода.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для &quot;if-else&quot; всегда помещайте наиболее вероятные условия на первые места. Тогда другие условия будут проверены реже, и код будет выполняться быстрее. В большинстве случаев это экономит время выполнения.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Использование &quot;switch-case&quot; устраняет недостаток &quot;if-else&quot;, потому что для &quot;switch-case&quot; компилятор обычно генерирует таблицы просмотра (lookup tables) с индексом и прямым переходом в нужное место.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Когда сложно использовать &quot;switch-case&quot;, мы можем разделить ветви &quot;if-else&quot; на уменьшенные подветви. Этот метод уменьшает время выполнения для самого худшего случая. В примере ниже данные считываются из ADC и затем посылаются через USART. Наихудшем случаем является результат ad_result &lt; = 240.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Таблица 4-4. Пример подветви if-else.</p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td bgcolor="#fafad2"></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">ветвь if-else</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">подветвь if-else</span></p></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Код на C</span></p></td>
<td bgcolor="#f8f8f8">
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#bc7a00;">#include &lt; avr/io.h &gt; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">uint8_t</span><span style=" font-family:'Courier New,courier';"> ad_result; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">uint8_t</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">readADC</span><span style=" font-family:'Courier New,courier';">()</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">{ </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">return</span><span style=" font-family:'Courier New,courier';"> ADCH; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">}; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">void</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">send</span><span style=" font-family:'Courier New,courier';">(</span><span style=" font-family:'Courier New,courier'; color:#b00040;">uint8_t</span><span style=" font-family:'Courier New,courier';"> data)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">{ </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   UDR0 </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> data; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">}; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">int</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">main</span><span style=" font-family:'Courier New,courier';">(</span><span style=" font-family:'Courier New,courier'; color:#b00040;">void</span><span style=" font-family:'Courier New,courier';">) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">{ </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; color:#b00040;">uint8_t</span><span style=" font-family:'Courier New,courier';"> output; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   ad_result </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> readADC(); </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">if</span><span style=" font-family:'Courier New,courier';">(ad_result </span><span style=" font-family:'Courier New,courier'; color:#666666;">&lt;=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">30</span><span style=" font-family:'Courier New,courier';">)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   { </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      output </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x6C</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   }</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">else</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">if</span><span style=" font-family:'Courier New,courier';">(ad_result </span><span style=" font-family:'Courier New,courier'; color:#666666;">&lt;=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">60</span><span style=" font-family:'Courier New,courier';">)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   { </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      output </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x6E</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   }</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">else</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">if</span><span style=" font-family:'Courier New,courier';">(ad_result </span><span style=" font-family:'Courier New,courier'; color:#666666;">&lt;=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">90</span><span style=" font-family:'Courier New,courier';">)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   { </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      output </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x68</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   }</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">else</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">if</span><span style=" font-family:'Courier New,courier';">(ad_result </span><span style=" font-family:'Courier New,courier'; color:#666666;">&lt;=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">120</span><span style=" font-family:'Courier New,courier';">)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   { </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      output </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x4C</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   }</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">else</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">if</span><span style=" font-family:'Courier New,courier';">(ad_result </span><span style=" font-family:'Courier New,courier'; color:#666666;">&lt;=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">150</span><span style=" font-family:'Courier New,courier';">)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   {</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      output </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x4E</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   }</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">else</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">if</span><span style=" font-family:'Courier New,courier';">(ad_result </span><span style=" font-family:'Courier New,courier'; color:#666666;">&lt;=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">180</span><span style=" font-family:'Courier New,courier';">)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   { </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      output </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x48</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   }</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">else</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">if</span><span style=" font-family:'Courier New,courier';">(ad_result </span><span style=" font-family:'Courier New,courier'; color:#666666;">&lt;=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">210</span><span style=" font-family:'Courier New,courier';">)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   { </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      output </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x57</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   }</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">else</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">if</span><span style=" font-family:'Courier New,courier';">(ad_result </span><span style=" font-family:'Courier New,courier'; color:#666666;">&lt;=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">240</span><span style=" font-family:'Courier New,courier';">)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   { </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      output </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x45</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   } </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   send(output); </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">}</span></pre></td>
<td bgcolor="#f8f8f8">
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier'; color:#b00040;">int</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#0000ff;">main</span><span style=" font-family:'Courier New,courier';">(</span><span style=" font-family:'Courier New,courier'; color:#b00040;">void</span><span style=" font-family:'Courier New,courier';">) </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">{ </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; color:#b00040;">uint8_t</span><span style=" font-family:'Courier New,courier';"> output; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   ad_result </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> readADC(); </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';"> </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">if</span><span style=" font-family:'Courier New,courier';"> (ad_result </span><span style=" font-family:'Courier New,courier'; color:#666666;">&lt;=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">120</span><span style=" font-family:'Courier New,courier';">)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   { </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">if</span><span style=" font-family:'Courier New,courier';"> (ad_result </span><span style=" font-family:'Courier New,courier'; color:#666666;">&lt;=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">60</span><span style=" font-family:'Courier New,courier';">)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      { </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">         </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">if</span><span style=" font-family:'Courier New,courier';"> (ad_result </span><span style=" font-family:'Courier New,courier'; color:#666666;">&lt;=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">30</span><span style=" font-family:'Courier New,courier';">)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">         { </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">            output </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x6C</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">         } </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">         </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">else</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">         { </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">            output </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x6E</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">         }</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      } </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">else</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      { </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">         </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">if</span><span style=" font-family:'Courier New,courier';"> (ad_result </span><span style=" font-family:'Courier New,courier'; color:#666666;">&lt;=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">90</span><span style=" font-family:'Courier New,courier';">)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">         { </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">            output </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x68</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">         } </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">         </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">else</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">         { </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">            output </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x4C</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">         } </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      } </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   } </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">else</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   { </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">if</span><span style=" font-family:'Courier New,courier';"> (ad_result </span><span style=" font-family:'Courier New,courier'; color:#666666;">&lt;=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">180</span><span style=" font-family:'Courier New,courier';">)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      {</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">         </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">if</span><span style=" font-family:'Courier New,courier';"> (ad_result </span><span style=" font-family:'Courier New,courier'; color:#666666;">&lt;=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">150</span><span style=" font-family:'Courier New,courier';">)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">         { </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">            output </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x4E</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">         } </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">         </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">else</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">         { </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">            output </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x48</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">         } </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      } </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">else</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      { </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">         </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">if</span><span style=" font-family:'Courier New,courier';"> (ad_result </span><span style=" font-family:'Courier New,courier'; color:#666666;">&lt;=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">210</span><span style=" font-family:'Courier New,courier';">)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">         { </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">            output </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x57</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">         } </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">         </span><span style=" font-family:'Courier New,courier'; font-weight:600; color:#008000;">else</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">         { </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">            output </span><span style=" font-family:'Courier New,courier'; color:#666666;">=</span><span style=" font-family:'Courier New,courier';"> </span><span style=" font-family:'Courier New,courier'; color:#666666;">0x45</span><span style=" font-family:'Courier New,courier';">; </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">         } </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">      } </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   } </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">   send(output); </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:125%; background-color:#f8f8f8;"><span style=" font-family:'Courier New,courier';">}</span></pre></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Использование памяти AVR</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Program: 198 bytes (2.4% full) <br />(.text + .data + .bootloader) <br />Data: 1 byte (0.1% full) <br />(.data + .bss + .noinit)</p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Program: 226 bytes (2.8% full) <br />(.text + .data + .bootloader) <br />Data: 1 byte (0.1% full) <br />(.data + .bss + .noinit)</p></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Счетчик тактов</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">58 (самый плохой случай)</p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">48<span style=" background-color:#fafad2;"> (самый плохой случай)</span></p></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Уровень оптимизации компилятора</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">-O3</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">-O3</p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Мы можем увидеть, что требуется меньше времени для достижения ветви в самом худшем случае. При этом можно заметить, что размер кода увеличился. Таким образом, здесь также виден баланс между скоростью и размером кода, который можно перевесить в нужную сторону в зависимости от специфичных требований к коду.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">[<span style=" font-weight:600;">5 Пример программы и результат тестирования</span>]</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Приложение примера используется для того, чтобы показать эффект по советам оптимизации, рассмотренным в статье. Для этого примера использовалась опция оптимизации по размеру (-s). В этом примере программы использовались некоторые (не все) подсказки для оптимизации кода. Один канал ADC используется для выборки входного сигнала, и результат передается через USART каждые 5 секунд. Если результат преобразования ADC выходит за установленные пределы, отправляется alarm за 30 секунд до того, как приложение переходит в состояние ошибки. В конце главного цикла main, микроконтроллер переходит в режим энергосбережения (power save mode).</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Результаты оптимизации по скорости и размеру этого приложения (до и после оптимизации) показаны в таблице 5-1.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Таблица 5-1. Результаты оптимизации примера программы.</p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td bgcolor="#0000ff">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600; color:#ffffff;">Объект теста</span></p></td>
<td bgcolor="#0000ff">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600; color:#ffffff;">До оптимизации</span></p></td>
<td bgcolor="#0000ff">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600; color:#ffffff;">После оптимизации</span></p></td>
<td bgcolor="#0000ff">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600; color:#ffffff;">Результат тестирования</span></p></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Объем кода (code size)</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">1444 байт</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">630 байт</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">-56.5%</span></p></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Объем данных (data size)</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">25 байт</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">0 байт</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">-100%</span></p></td></tr>
<tr>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">Скорость выполнения (execution speed) </span><span style=" vertical-align:super;">(1)</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">3.88 мс</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">2.6 мс</span></p></td>
<td bgcolor="#fafad2">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" background-color:#fafad2;">-33.0%</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" color:#808080;">Примечание 1: один цикл включает пять чтений выборок из ADC и одну передачу через USART.</span></p></body></html>